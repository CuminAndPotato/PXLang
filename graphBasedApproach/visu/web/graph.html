<!DOCTYPE html>
<html>
<head>
    <title>Graph</title>

    <meta name="description" content="A family tree diagram of British royalty." />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            margin: 2.5vh;
        }

        #diagramDiv {
            min-width: 95vh;
            min-height: 95vh;
            border: none;
            background-color: white;
        }

            #diagramDiv canvas {
                outline: none;
            }
    </style>

    <script src="go.js"></script>
    <script src="data.js"></script>

    <script id="code">
        function init() {
            var $ = go.GraphObject.make; // for conciseness in defining templates

            var getLayout = function () {
                if (window.layout === "graph") {
                    return $(go.ForceDirectedLayout,
                        {
                            randomNumberGenerator: null, // deterministic layout
                            maxIterations: 1000
                        });
                } else {
                    return $(go.TreeLayout,
                        {
                            angle: 90
                        });
                }
            }

            var myDiagram =
                $(go.Diagram,
                    "diagramDiv", // must be the ID or reference to div
                    {
                        layout: getLayout(),
                        initialAutoScale: go.Diagram.Uniform,
                        initialContentAlignment: go.Spot.Center,
                        "toolManager.mouseWheelBehavior": go.ToolManager.WheelZoom
                    });

            var hideWhenEmpty = function (prop) {
                return new go.Binding("height",
                    prop,
                    function (x) {
                        if (x === "") return 0;
                        else return undefined;
                    });
            };

            myDiagram.nodeTemplate =
                $(go.Node, "Auto",
                    $(go.Shape,
                        {
                            fill: "white",
                            stroke: "darkblue",
                            strokeWidth: 2
                        },
                        new go.Binding("figure", "fig")),
                    $(go.Panel, "Table",
                        {
                            defaultAlignment: go.Spot.Left,
                            margin: 10
                        },
                        $(go.RowColumnDefinition,
                            {
                                column: 1,
                                width: 1
                            }),
                        $(go.TextBlock,
                            {
                                row: 0,
                                alignment: go.Spot.Center,
                                font: "bold 12pt sans-serif"
                            },
                            hideWhenEmpty("name"),
                            new go.Binding("text", "name")),
                        $(go.TextBlock,
                            {
                                row: 1,
                                font: "10pt Consolas",
                                spacingAbove: 2,
                                spacingBelow: 2
                            },
                            hideWhenEmpty("desc"),
                            new go.Binding("text", "desc"))
                    )
                );

            myDiagram.linkTemplate =
                $(go.Link, // the whole link panel
                    $(go.Shape), // the link shape
                    $(go.Shape, // the arrowhead
                        {
                            toArrow: "OpenTriangle",
                            fill: null
                        })
                );

            // animations: see commented code below
            myDiagram.animationManager.initialAnimationStyle = go.AnimationManager.None;

            myDiagram.model = new go.GraphLinksModel(window.nodeDataArray, window.linkDataArray);

            //// only needed for this demonstration, this flag is used to stop
            //// the "InitialAnimationStarting" listener when other buttons are pressed
            //window.custom = false;
            //window.animateDefault = function() {
            //    window.custom = false;
            //    diagram.animationManager.initialAnimationStyle = go.AnimationManager.Default;
            //    diagram.model = go.Model.fromJSON(diagram.model.toJSON());
            //}
            //window.animateLocations = function() {
            //    window.custom = false;
            //    diagram.animationManager.initialAnimationStyle = go.AnimationManager.AnimateLocations;
            //    diagram.model = go.Model.fromJSON(diagram.model.toJSON());
            //}
            //window.animateNone = function() {
            //    window.custom = false;
            //    diagram.animationManager.initialAnimationStyle = go.AnimationManager.None;
            //    diagram.model = go.Model.fromJSON(diagram.model.toJSON());
            //}
            //window.animateCustom = function() {
            //    window.custom = true;
            //    diagram.animationManager.initialAnimationStyle = go.AnimationManager.None;
            //    // Customer listener zooms-in the Diagram on load:
            //    diagram.addDiagramListener("InitialAnimationStarting",
            //        function(e) {
            //            var animation = e.subject.defaultAnimation;
            //            if (window.custom === false) {
            //                // a different button was pressed, restore default values on the default animation:
            //                animation.easing = go.Animation.EaseInOutQuad;
            //                animation.duration = NaN;
            //                return;
            //            }
            //            animation.easing = go.Animation.EaseOutExpo;
            //            animation.duration = 1500;
            //            animation.add(e.diagram, 'scale', 0.1, 1);
            //            animation.add(e.diagram, 'opacity', 0, 1);
            //        });
            //    diagram.model = go.Model.fromJSON(diagram.model.toJSON());
            //}

            window.myDiagram = myDiagram;
        };

    </script>
</head>
<body onload="init()">
    <div id="diagramDiv"></div>
</body>
</html>